<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="common.css">
  </head>
  <body>
    <div id="box">
      <button id="update">Update</button>
      <div id="container"></div>
    </div>
    <script src="../lib/require.js"></script>
    <script src="../requirejs.conf.js"></script>
    <script>
      require(['glimpse'], function (glimpse) {
        'use strict';
        var epochBaseMs,
          oneDayMs,
          latencyData,
          lineGraph,
          currentDay,
          currentDay,
          update;

        epochBaseMs = new Date().getTime();
        oneDayMs = 1000 * 60 * 60 * 24;

        latencyData = [
          {
            data: [
              {"x":epochBaseMs + 0 * oneDayMs,"y": 80},
              {"x":epochBaseMs + 1 * oneDayMs,"y": 120},
              {"x":epochBaseMs + 2 * oneDayMs,"y": 60},
              {"x":epochBaseMs + 3 * oneDayMs,"y": 90},
              {"x":epochBaseMs + 4 * oneDayMs,"y": 100}
            ]
          }
        ];

        lineGraph = glimpse.graph()
          .config({
            width: 700,
            height: 250,
            domainIntervalUnit: d3.time.week,
            forceY: [0]
          })
          .data([
            {
              id: 'latencyDfw',
              title: 'Time to Connect (DFW)',
              data: latencyData[0].data,
              x: function (d, i) { return d.x + 5; },
              y: function (d, i) { return d.y + 10; }
            },
            {
              id: 'latencyOrd',
              title: 'Time to Connect (ORD)',
              data: latencyData[0].data,
              x: function (d, i) { return d.x; },
              y: function (d, i) { return d.y; }
            },
            { id: 'latencyLon',
                title: 'Time to Connect (LON)',
                data: latencyData[0].data,
                x: function (d, i) { return d.x; },
                y: function (d, i) { return d.y + Math.random()*10; }
              }
          ])
          .component({ cid: 'lineOrd', type: 'line', dataId: 'latencyOrd', color: '#206ec2', opacity: '0.4' })
          .component({ cid: 'lineDfw', type: 'line', dataId: 'latencyDfw', color: '#e65b1f', opacity: '0.6'  })
          .component({ cid: 'lineLon', type: 'line', dataId: 'latencyLon', color: '#c40022', opacity: '0.7'  })
          .render('#container');

        currentDay = latencyData[0].data.length;

        //for debugging
        window.graph = lineGraph;

        update = function () {
          lineGraph.appendData(
              'latencyOrd',
              {"x":epochBaseMs + currentDay++ * oneDayMs, "y": (Math.random() * 150)}
            )
            .update()
            .hide('lineOrd');
        };

        document.getElementById('update').addEventListener('click', update, false);
      });
    </script>
  </body>
</html>
